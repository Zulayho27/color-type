<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inuri Color Analyzer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* (–í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π CSS –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) */
        :root {
            --color-text: #ffffff;
            --color-text-dark: #333;
            --color-primary: #a259ff;
            --border-radius: 16px;
            --font-main: 'Manrope', sans-serif;
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
        }

        body {
            font-family: var(--font-main);
            color: var(--color-text);
            margin: 0;
            padding: 24px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient-flow 15s ease infinite;
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 600;
            position: absolute;
            top: 24px;
            left: 32px;
            color: var(--color-text);
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow);
            padding: 32px;
            width: 100%;
            max-width: 500px;
            text-align: center;
            overflow: hidden;
            transition: height 0.4s ease;
        }
        
        /* (–û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏...) */
        
        .wizard-step { display: none; }
        .wizard-step.active { display: block; }
        h1, h2 { font-weight: 600; margin-top: 0; }
        h4 { font-weight: 600; margin-bottom: 8px; }
        p { font-weight: 300; font-size: 1.1rem; line-height: 1.6; }
        
        /* (–°—Ç–∏–ª–∏ —Å–∫–∞–Ω–µ—Ä–∞, –∫–Ω–æ–ø–æ–∫ –∏ —Ç.–¥. –æ—Å—Ç–∞—é—Ç—Å—è) */
        .scanner-container { position: relative; width: 100%; max-width: 400px; margin: 20px auto; border-radius: 8px; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.3); }
        #video-feed { width: 100%; height: auto; display: block; }
        .reticle { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; border: 2px solid var(--color-primary); border-radius: 50%; background: rgba(255, 255, 255, 0.3); box-shadow: 0 0 10px var(--color-primary); }
        .verification-ui { margin-top: 24px; }
        .color-sample { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 16px; border: 4px solid #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .button-group { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .manual-picker { margin-top: 16px; }
        .manual-picker label { font-size: 0.9rem; margin-right: 10px; }
        .btn { font-family: var(--font-main); font-size: 1rem; font-weight: 600; padding: 14px 24px; border: none; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; }
        .btn-primary { background-color: var(--color-primary); color: #fff; box-shadow: 0 4px 15px rgba(162, 89, 255, 0.4); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(162, 89, 255, 0.6); }
        .btn-secondary { background: rgba(255, 255, 255, 0.3); color: #fff; border: 1px solid rgba(255, 255, 255, 0.5); }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.5); }
        
        /* --- –ò–ó–ú–ï–ù–ï–ù–û: –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ-–ø–∞–Ω–µ–ª–∏ --- */
        .info-panel {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 16px;
            margin-top: 24px;
            text-align: left;
            
            /* –í–∞—à–∞ –∏–¥–µ—è –≤ –¥–µ–π—Å—Ç–≤–∏–∏! */
            opacity: 0.2; /* –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            transition: opacity 0.4s ease;
            cursor: help; /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ "–Ω–∞–≤–µ–¥–∏ –º–µ–Ω—è" */
        }
        
        .info-panel:hover {
            opacity: 1; /* –°—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–∏–º—ã–º –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }
        
        .info-panel p {
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 8px 0 0 0;
        }
        /* ------------------------------------- */

        
        /* (–°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ—Å—Ç–∞—é—Ç—Å—è) */
        #result-screen h2 { color: #fff; }
        #result-type { font-size: 1.8rem; font-weight: 600; color: var(--color-primary); background: #fff; padding: 10px 20px; border-radius: 10px; margin: 16px 0; display: inline-block; color: var(--color-text-dark); }
        .palette { margin-top: 20px; }
        .palette-grid { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        .palette-swatch { width: 40px; height: 40px; border-radius: 50%; border: 2px solid #fff; }
        #result-psychology { margin-top: 24px; text-align: left; background: rgba(0, 0, 0, 0.1); border-radius: 10px; padding: 16px; }
        #result-psychology h4 { margin-top: 0; color: #fff; }
        #result-psychology p { font-size: 0.95rem; font-weight: 300; margin: 0; }
        #result-psychology ul { font-size: 0.95rem; font-weight: 300; margin-top: 10px; padding-left: 20px; }
        
        #canvas { display: none; }

    </style>
</head>
<body>

    <div class="logo">Inuri</div>
    <canvas id="canvas"></canvas>

    <div class="glass-card">
        <div id="wizard-container">

            <div class="wizard-step active" data-step="0">
                <h1>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ü–∞–ª–∏—Ç—Ä—ã</h1>
                <p>–î–∞–≤–∞–π—Ç–µ –Ω–∞–π–¥–µ–º –≤–∞—à –∏–¥–µ–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç–æ—Ç–∏–ø —Å –ø–æ–º–æ—â—å—é –∫–∞–º–µ—Ä—ã. –ú—ã –ø–æ–º–æ–∂–µ–º –≤–∞–º –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å 3 —Ç–æ—á–∫–∏: –∫–æ–∂—É, –≤–æ–ª–æ—Å—ã –∏ –≥–ª–∞–∑–∞.</p>
                
                <div class="button-group">
                    <button class="btn btn-primary" id="start-btn">–ù–∞—á–∞—Ç—å –ê–Ω–∞–ª–∏–∑</button>
                    </div>
                
                <div class="info-panel" id="info-panel" title="–ù–∞–≤–µ–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å">
                    <h4>4 –°–µ–∑–æ–Ω–∞ –¶–≤–µ—Ç–∞</h4>
                    <p><strong>‚ùÑÔ∏è –ó–∏–º–∞:</strong> –•–æ–ª–æ–¥–Ω—ã–µ, —è—Ä–∫–∏–µ, –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ (—Å–∏–Ω–∏–π, —Ñ—É–∫—Å–∏—è). –î–ª—è –ª—é–¥–µ–π —Å –≤—ã—Å–æ–∫–∏–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç–æ–º.</p>
                    <p><strong>üå∏ –í–µ—Å–Ω–∞:</strong> –¢–µ–ø–ª—ã–µ, —è—Ä–∫–∏–µ, —Å–≤–µ—Ç–ª—ã–µ (–ø–µ—Ä—Å–∏–∫, –∞–∫–≤–∞–º–∞—Ä–∏–Ω). –î–ª—è "—Å–∏—è—é—â–µ–π" –≤–Ω–µ—à–Ω–æ—Å—Ç–∏.</p>
                    <p><strong>‚òÄÔ∏è –õ–µ—Ç–æ:</strong> –•–æ–ª–æ–¥–Ω—ã–µ, –º—è–≥–∫–∏–µ, –ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω—ã–µ (–ª–∞–≤–∞–Ω–¥–∞, —Å–µ—Ä–æ-–≥–æ–ª—É–±–æ–π). –î–ª—è –¥–µ–ª–∏–∫–∞—Ç–Ω–æ–π –≤–Ω–µ—à–Ω–æ—Å—Ç–∏.</p>
                    <p><strong>üçÇ –û—Å–µ–Ω—å:</strong> –¢–µ–ø–ª—ã–µ, –º—è–≥–∫–∏–µ, –∑–µ–º–ª–∏—Å—Ç—ã–µ (–æ–ª–∏–≤–∞, —Ç–µ—Ä—Ä–∞–∫–æ—Ç–∞). –î–ª—è "–±–∞—Ä—Ö–∞—Ç–Ω–æ–π" –≤–Ω–µ—à–Ω–æ—Å—Ç–∏.</p>
                </div>
                </div>

            <div class="wizard-step" data-step="1">
                <h2 id="step-title">–®–∞–≥ 1: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ö–æ–∂–∏</h2>
                <p id="step-instruction">–ù–∞–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—Ü–µ–ª –Ω–∞ —É—á–∞—Å—Ç–æ–∫ –∫–æ–∂–∏ (–±–µ–∑ –º–∞–∫–∏—è–∂–∞) –ø—Ä–∏ –¥–Ω–µ–≤–Ω–æ–º —Å–≤–µ—Ç–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å".</p>
                <div class="scanner-container">
                    <video id="video-feed" autoplay playsinline></video>
                    <div class="reticle"></div>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" id="scan-btn">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>

            <div class="wizard-step" data-step="2">
                <h2>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¶–≤–µ—Ç</h2>
                <p>–ú—ã "—É–≤–∏–¥–µ–ª–∏" —ç—Ç–æ—Ç –æ—Ç—Ç–µ–Ω–æ–∫. –û–Ω –≤–µ—Ä–Ω—ã–π?</p>
                <div class="verification-ui">
                    <div class="color-sample" id="color-sample"></div>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" id="confirm-btn">‚úÖ –î–∞, –≤–µ—Ä–Ω–æ</button>
                    <button class="btn btn-secondary" id="retry-btn">üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ</button>
                </div>
                <div class="manual-picker">
                    <label for="manual-color">–ò–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:</label>
                    <input type="color" id="manual-color" value="#ffffff">
                    <button class="btn btn-secondary" id="manual-confirm-btn">OK</button>
                </div>
            </div>
            
            <div class="wizard-step" data-step="3">
                <h2>–í–∞—à –†–µ–∑—É–ª—å—Ç–∞—Ç!</h2>
                <p>–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –≤–∞—à–µ–π –∫–æ–∂–∏, –≤–æ–ª–æ—Å –∏ –≥–ª–∞–∑, –≤–∞—à —Ü–≤–µ—Ç–æ—Ç–∏–ø:</p>
                <div id="result-type">...–ê–Ω–∞–ª–∏–∑...</div>
                
                <div class="palette">
                    <h4>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–∞–ª–∏—Ç—Ä–∞:</h4>
                    <div class="palette-grid" id="best-palette"></div>
                </div>
                <div class="palette">
                    <h4>–°—Ç–æ–∏—Ç –∏–∑–±–µ–≥–∞—Ç—å:</h4>
                    <div class="palette-grid" id="avoid-palette"></div>
                </div>

                <div id="result-psychology">
                    </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" id="restart-btn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                </div>
            </div>

        </div>
    </div>


    <script>
        // ‚ö° JavaScript: –õ–æ–≥–∏–∫–∞ –°–∫–∞–Ω–µ—Ä–∞ –∏ –ú–∞—Å—Ç–µ—Ä–∞
        
        // --- 1. DOM –≠–ª–µ–º–µ–Ω—Ç—ã ---
        const wizardContainer = document.getElementById('wizard-container');
        const allSteps = document.querySelectorAll('.wizard-step');
        const startBtn = document.getElementById('start-btn');
        const scanBtn = document.getElementById('scan-btn');
        const confirmBtn = document.getElementById('confirm-btn');
        const retryBtn = document.getElementById('retry-btn');
        const manualColorInput = document.getElementById('manual-color');
        const manualConfirmBtn = document.getElementById('manual-confirm-btn');
        const restartBtn = document.getElementById('restart-btn');

        const video = document.getElementById('video-feed');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const colorSample = document.getElementById('color-sample');

        const stepTitle = document.getElementById('step-title');
        const stepInstruction = document.getElementById('step-instruction');
        
        // --- –ò–ó–ú–ï–ù–ï–ù–û: DOM –¥–ª—è –ò–Ω—Ñ–æ-–±–ª–æ–∫–æ–≤ ---
        // const infoToggleBtn = document.getElementById('info-toggle-btn'); // –£–î–ê–õ–ï–ù–û
        const infoPanel = document.getElementById('info-panel');
        const resultPsychologyEl = document.getElementById('result-psychology');
        // ------------------------------------

        // --- 2. –°–æ—Å—Ç–æ—è–Ω–∏–µ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
        let currentWizardStep = 0;
        let currentScanTarget = 'skin'; 
        const scanTargets = [
            { id: 'skin', title: '–®–∞–≥ 1: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ö–æ–∂–∏', instruction: '–ù–∞–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—Ü–µ–ª –Ω–∞ —É—á–∞—Å—Ç–æ–∫ –∫–æ–∂–∏ (–±–µ–∑ –º–∞–∫–∏—è–∂–∞) –ø—Ä–∏ –¥–Ω–µ–≤–Ω–æ–º —Å–≤–µ—Ç–µ.' },
            { id: 'hair', title: '–®–∞–≥ 2: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –í–æ–ª–æ—Å', instruction: '–¢–µ–ø–µ—Ä—å –Ω–∞–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—Ü–µ–ª –Ω–∞ –≤–∞—à –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –≤–æ–ª–æ—Å.' },
            { id: 'eyes', title: '–®–∞–≥ 3: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ì–ª–∞–∑', instruction: '–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –Ω–∞–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—Ü–µ–ª –Ω–∞ —Ü–≤–µ—Ç –≤–∞—à–∏—Ö –≥–ª–∞–∑.' }
        ];
        const collectedColors = { skin: null, hair: null, eyes: null };
        let stream = null; 

        // --- 3. –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ "–ú–∞—Å—Ç–µ—Ä—É" ---
        function goToStep(stepNumber) {
            allSteps.forEach(step => step.classList.remove('active'));
            const nextStep = wizardContainer.querySelector(`.wizard-step[data-step="${stepNumber}"]`);
            if (nextStep) {
                nextStep.classList.add('active');
                currentWizardStep = stepNumber;
            }
        }

        // --- 4. –õ–æ–≥–∏–∫–∞ –ö–∞–º–µ—Ä—ã ---
        async function startCamera() {
            try {
                if (stream) { stream.getTracks().forEach(track => track.stop()); }
                stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                video.srcObject = stream;
                video.play();
            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ", err);
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
                goToStep(0); 
            }
        }
        
        function stopCamera() {
             if (stream) { stream.getTracks().forEach(track => track.stop()); stream = null; }
        }

        // --- 5. –õ–æ–≥–∏–∫–∞ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¶–≤–µ—Ç–∞ ---
        // (–§—É–Ω–∫—Ü–∏–∏ scanColor, getAverageColor, rgbToHex –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        function scanColor() {
            video.pause();
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const centerX = Math.floor(canvas.width / 2);
            const centerY = Math.floor(canvas.height / 2);
            const avgColor = getAverageColor(centerX, centerY, 10);
            const hexColor = `#${rgbToHex(avgColor.r, avgColor.g, avgColor.b)}`;
            colorSample.style.backgroundColor = hexColor;
            manualColorInput.value = hexColor;
            goToStep(2);
        }
        function getAverageColor(x, y, size) {
            const imageData = ctx.getImageData(x - size/2, y - size/2, size, size).data;
            let r = 0, g = 0, b = 0;
            for (let i = 0; i < imageData.length; i += 4) { r += imageData[i]; g += imageData[i+1]; b += imageData[i+2]; }
            const count = imageData.length / 4;
            return { r: Math.floor(r / count), g: Math.floor(g / count), b: Math.floor(b / count) };
        }
        function rgbToHex(r, g, b) {
            return [r, g, b].map(x => { const hex = x.toString(16); return hex.length === 1 ? '0' + hex : hex; }).join('');
        }
        
        // --- 6. –õ–æ–≥–∏–∫–∞ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ ---
        // (–§—É–Ω–∫—Ü–∏–∏ confirmColor, updateScannerUI –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        function confirmColor(hexColor) {
            collectedColors[currentScanTarget] = hexColor;
            const currentTargetIndex = scanTargets.findIndex(t => t.id === currentScanTarget);
            if (currentTargetIndex < scanTargets.length - 1) {
                currentScanTarget = scanTargets[currentTargetIndex + 1].id;
                updateScannerUI();
                video.play(); 
                goToStep(1); 
            } else {
                stopCamera();
                calculateResult();
                goToStep(3); 
            }
        }
        function updateScannerUI() {
            const target = scanTargets.find(t => t.id === currentScanTarget);
            stepTitle.textContent = target.title;
            stepInstruction.textContent = target.instruction;
        }

        // --- 7. "–ú–æ–∑–≥": –†–∞—Å—á–µ—Ç –†–µ–∑—É–ª—å—Ç–∞—Ç–∞ ---
        // (–§—É–Ω–∫—Ü–∏—è calculateResult –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –≤–∫–ª—é—á–∞—è –≤—Å—é –ø—Å–∏—Ö–æ–ª–æ–≥–∏—é)
        function calculateResult() {
            function hexToRgb(hex) {
                let r = 0, g = 0, b = 0;
                if (hex.length == 4) { r = "0x" + hex[1] + hex[1]; g = "0x" + hex[2] + hex[2]; b = "0x" + hex[3] + hex[3]; } 
                else if (hex.length == 7) { r = "0x" + hex[1] + hex[2]; g = "0x" + hex[3] + hex[4]; b = "0x" + hex[5] + hex[6]; }
                return { r: +r, g: +g, b: +b };
            }
            function rgbToHsl(r, g, b) {
                r /= 255; g /= 255; b /= 255;
                let max = Math.max(r, g, b), min = Math.min(r, g, b);
                let h, s, l = (max + min) / 2;
                if (max == min) { h = s = 0; } 
                else {
                    let d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch (max) {
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                }
                return { h: h * 360, s: s * 100, l: l * 100 };
            }
            const skinHsl = rgbToHsl(hexToRgb(collectedColors.skin).r, hexToRgb(collectedColors.skin).g, hexToRgb(collectedColors.skin).b);
            const hairHsl = rgbToHsl(hexToRgb(collectedColors.hair).r, hexToRgb(collectedColors.hair).g, hexToRgb(collectedColors.hair).b);
            const tone = (skinHsl.h > 25 && skinHsl.h < 200) ? 'cool' : 'warm';
            const lightnessDiff = Math.abs(skinHsl.l - hairHsl.l);
            const contrast = (lightnessDiff > 40 || hairHsl.l < 20) ? 'high' : 'low';
            let resultType = '', bestColors = [], avoidColors = [], psychologyText = '';

            if (tone === 'warm') {
                if (contrast === 'high') {
                    resultType = 'üå∏ –í–µ—Å–Ω–∞';
                    bestColors = ['#FF7F50', '#98FB98', '#40E0D0', '#FFD700', '#F08080'];
                    avoidColors = ['#000000', '#4B0082', '#808080'];
                    psychologyText = `<h4>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –≤–∞—à–µ–π –ø–∞–ª–∏—Ç—Ä—ã: –≠–Ω–µ—Ä–≥–∏—è –∏ –û–ø—Ç–∏–º–∏–∑–º</h4><p>–í–∞—à–∏ —Ç–µ–ø–ª—ã–µ, —Å–≤–µ—Ç–ª—ã–µ –∏ —Å–∏—è—é—â–∏–µ —Ü–≤–µ—Ç–∞ (–∫–∞–∫ –ø–µ—Ä—Å–∏–∫–æ–≤—ã–π, —Å–≤–µ—Ç–ª–æ-–∫–æ—Ä–∞–ª–ª–æ–≤—ã–π –∏ –∞–∫–≤–∞–º–∞—Ä–∏–Ω) ‚Äî —ç—Ç–æ —á–∏—Å—Ç–∞—è <strong>—Ä–∞–¥–æ—Å—Ç—å, –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –¥—Ä—É–∂–µ–ª—é–±–∏–µ</strong>.</p><ul><li><strong>–•–æ—Ç–∏—Ç–µ –ø–æ–¥–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?</strong> –ü—Ä–æ—Å—Ç–æ –Ω–∞–¥–µ–Ω—å—Ç–µ —á—Ç–æ-—Ç–æ –∏–∑ –≤–∞—à–µ–π –ø–∞–ª–∏—Ç—Ä—ã!</li><li><strong>–î–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞:</strong> –í–∞—à–∏ —Ü–≤–µ—Ç–∞ –¥–µ–ª–∞—é—Ç –≤–∞—Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏ –ª—É—á–µ–∑–∞—Ä–Ω—ã–º. –û–Ω–∏ –≥–æ–≤–æ—Ä—è—Ç: "–Ø –ø–æ–ª–æ–Ω –∏–¥–µ–π –∏ —ç–Ω—Ç—É–∑–∏–∞–∑–º–∞!"</li></ul>`;
                } else {
                    resultType = 'üçÇ –û—Å–µ–Ω—å';
                    bestColors = ['#8B4513', '#CD853F', '#556B2F', '#D2B48C', '#A0522D'];
                    avoidColors = ['#0000FF', '#FF00FF', '#E0FFFF'];
                    psychologyText = `<h4>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –≤–∞—à–µ–π –ø–∞–ª–∏—Ç—Ä—ã: –¢–µ–ø–ª–æ—Ç–∞ –∏ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å</h4><p>–í–∞—à–∏ –≥–ª—É–±–æ–∫–∏–µ, –±–æ–≥–∞—Ç—ã–µ –∏ –∑–µ–º–ª–∏—Å—Ç—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ (–∫–∞–∫ –æ–ª–∏–≤–∫–æ–≤—ã–π, —Ç–µ—Ä—Ä–∞–∫–æ—Ç–æ–≤—ã–π –∏ —à–æ–∫–æ–ª–∞–¥–Ω—ã–π) –∏–∑–ª—É—á–∞—é—Ç <strong>–∫–æ–º—Ñ–æ—Ä—Ç, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —É—Ç–æ–Ω—á–µ–Ω–Ω–æ—Å—Ç—å</strong>.</p><ul><li><strong>–•–æ—Ç–∏—Ç–µ –≤—ã–∑–≤–∞—Ç—å –¥–æ–≤–µ—Ä–∏–µ?</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–ª—É–±–æ–∫–∏–π –∑–µ–ª–µ–Ω—ã–π –∏–ª–∏ —Ç–µ–ø–ª—ã–π –±–µ–∂–µ–≤—ã–π.</li><li><strong>–î–ª—è —É—é—Ç–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∏:</strong> –í–∞—à–∏ —Ü–≤–µ—Ç–∞ –¥–µ–ª–∞—é—Ç –≤–∞—Å –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –ø—Ä–∏—Ç—è–≥–∞—Ç–µ–ª—å–Ω—ã–º –∏ "—Å–≤–æ–∏–º". –û–Ω–∏ –≥–æ–≤–æ—Ä—è—Ç: "–ù–∞ –º–µ–Ω—è –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å—Å—è".</li></ul>`;
                }
            } else { // tone === 'cool'
                if (contrast === 'high') {
                    resultType = '‚ùÑÔ∏è –ó–∏–º–∞';
                    bestColors = ['#000000', '#FFFFFF', '#1E90FF', '#DC143C', '#FF00FF'];
                    avoidColors = ['#FFA500', '#A52A2A', '#DAA520'];
                    psychologyText = `<h4>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –≤–∞—à–µ–π –ø–∞–ª–∏—Ç—Ä—ã: –°–∏–ª–∞ –∏ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</h4><p>–í–∞—à–∏ —è—Ä–∫–∏–µ, —á–∏—Å—Ç—ã–µ –∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ (–∫–∞–∫ –∫–æ–±–∞–ª—å—Ç–æ–≤—ã–π —Å–∏–Ω–∏–π, —Ä—É–±–∏–Ω–æ–≤—ã–π –∫—Ä–∞—Å–Ω—ã–π –∏ —á–∏—Å—Ç—ã–π –±–µ–ª—ã–π) ‚Äî —ç—Ç–æ —Ü–≤–µ—Ç–∞ <strong>–ª–∏–¥–µ—Ä—Å—Ç–≤–∞, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–∞ –∏ –¥—Ä–∞–º—ã</strong>.</p><ul><li><strong>–•–æ—Ç–∏—Ç–µ –±—ã—Ç—å –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è?</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–∫—Å–∏—é –∏–ª–∏ –∏–∑—É–º—Ä—É–¥–Ω—ã–π.</li><li><strong>–î–ª—è –¥–µ–ª–æ–≤–æ–π –≤—Å—Ç—Ä–µ—á–∏:</strong> –°–æ—á–µ—Ç–∞–Ω–∏–µ —á–µ—Ä–Ω–æ–≥–æ, –±–µ–ª–æ–≥–æ –∏ –æ–¥–Ω–æ–≥–æ —è—Ä–∫–æ–≥–æ –∞–∫—Ü–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç –æ–±—Ä–∞–∑ —Å–∏–ª—å–Ω–æ–≥–æ –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞. –í–∞—à–∏ —Ü–≤–µ—Ç–∞ –≥–æ–≤–æ—Ä—è—Ç –∑–∞ –≤–∞—Å: "–Ø –∑–Ω–∞—é, —á–µ–≥–æ —Ö–æ—á—É".</li></ul>`;
                } else {
                    resultType = '‚òÄÔ∏è –õ–µ—Ç–æ';
                    bestColors = ['#B0C4DE', '#FFB6C1', '#E6E6FA', '#DDA0DD', '#87CEFA'];
                    avoidColors = ['#FF0000', '#FFA500', '#000000'];
                    psychologyText = `<h4>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –≤–∞—à–µ–π –ø–∞–ª–∏—Ç—Ä—ã: –≠–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç—å –∏ –°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ</h4><p>–í–∞—à–∏ –º—è–≥–∫–∏–µ, –ø—Ä–æ—Ö–ª–∞–¥–Ω—ã–µ –∏ –ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ (–∫–∞–∫ –ø—ã–ª—å–Ω–∞—è —Ä–æ–∑–∞, –ª–∞–≤–∞–Ω–¥–∞ –∏ —Å–µ—Ä–æ-–≥–æ–ª—É–±–æ–π) —Å–æ–∑–¥–∞—é—Ç –∞—É—Ä—É <strong>–∏–∑—è—â–µ—Å—Ç–≤–∞, –±–µ–∑–º—è—Ç–µ–∂–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞</strong>.</p><ul><li><strong>–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ?</strong> –í–∞—à–∞ –ø–∞–ª–∏—Ç—Ä–∞ ‚Äî —ç—Ç–æ "—Ç–∏—Ö–∞—è —Ä–æ—Å–∫–æ—à—å".</li><li><strong>–î–ª—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤:</strong> –í–∞—à–∏ —Ü–≤–µ—Ç–∞ —É—Å–ø–æ–∫–∞... </ul>`;
                }
            }
            
            document.getElementById('result-type').textContent = resultType;
            resultPsychologyEl.innerHTML = psychologyText;
            
            function populatePalette(elementId, colors) {
                const container = document.getElementById(elementId);
                container.innerHTML = '';
                colors.forEach(color => {
                    const swatch = document.createElement('div');
                    swatch.className = 'palette-swatch';
                    swatch.style.backgroundColor = color;
                    swatch.title = color;
                    if (color === '#FFFFFF') swatch.style.borderColor = '#ccc';
                    container.appendChild(swatch);
                });
            }
            populatePalette('best-palette', bestColors);
            populatePalette('avoid-palette', avoidColors);
        }

        // --- 8. –°–ª—É—à–∞—Ç–µ–ª–∏ –°–æ–±—ã—Ç–∏–π ---
        
        startBtn.addEventListener('click', () => {
            currentScanTarget = 'skin';
            updateScannerUI();
            startCamera();
            goToStep(1);
        });
        
        scanBtn.addEventListener('click', scanColor);
        retryBtn.addEventListener('click', () => { video.play(); goToStep(1); });
        confirmBtn.addEventListener('click', () => { confirmColor(manualColorInput.value); });
        manualConfirmBtn.addEventListener('click', () => { colorSample.style.backgroundColor = manualColorInput.value; });
        manualColorInput.addEventListener('input', () => { colorSample.style.backgroundColor = manualColorInput.value; });
        
        restartBtn.addEventListener('click', () => {
            collectedColors.skin = null;
            collectedColors.hair = null;
            collectedColors.eyes = null;
            // infoPanel.classList.remove('visible'); // –ò–ó–ú–ï–ù–ï–ù–û: –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞
            goToStep(0);
        });
        
        // --- –ò–ó–ú–ï–ù–ï–ù–û: –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ñ–æ-–ø–∞–Ω–µ–ª–∏ –£–î–ê–õ–ï–ù ---
        
    </script>
</body>
</html>